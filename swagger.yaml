openapi: 3.0.0
info:
  title: NutriScan API
  version: 1.0.0
  description: |
    ğŸ§  API para el sistema de recomendaciones nutricionales y anÃ¡lisis de salud
    
    **âœ¨ CaracterÃ­sticas principales:**
    - ğŸ” AutenticaciÃ³n JWT
    - ğŸ¤– AnÃ¡lisis de datos clÃ­nicos con ML
    - ğŸ¥— Recomendaciones nutricionales personalizadas
    - ğŸ‘¤ GestiÃ³n de usuarios y perfiles
    - ğŸ“Š AuditorÃ­a de acciones administrativas
  contact:
    name: ğŸ’š NutriScan Team
    email: support@nutriscanu.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:5000
    description: ğŸ  Servidor de desarrollo local

tags:
  - name: ğŸ” Authentication
    description: Operaciones de autenticaciÃ³n y autorizaciÃ³n
  - name: ğŸ‘¤ Profile
    description: Operaciones sobre el perfil del usuario
  - name: ğŸ¥ Clinical Profile
    description: Registro y gestiÃ³n del perfil clÃ­nico del usuario
  - name: ğŸ©¸ Blood Analysis
    description: Consulta de resultados de anÃ¡lisis de sangre
  - name: ğŸ’¡ Recommendations
    description: GeneraciÃ³n y consulta de recomendaciones nutricionales
  - name: ğŸ“Š Analysis History
    description: Historial de anÃ¡lisis y recomendaciones
  - name: ğŸ‘¨â€ğŸ’¼ Admin
    description: Operaciones administrativas (solo administradores)
  - name: ğŸ“‹ Audit
    description: AuditorÃ­a y logs del sistema

paths:
  # =============================================================================
  # ğŸ” AUTHENTICATION ENDPOINTS
  # =============================================================================
  
  /api/auth/register:
    post:
      summary: ğŸ“ Registrar nuevo usuario
      description: Registra un nuevo usuario estudiante en el sistema
      tags: [ğŸ” Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '201':
          description: âœ… Usuario registrado correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: âš ï¸ Email o DNI ya registrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/auth/login:
    post:
      summary: ğŸšª Iniciar sesiÃ³n
      description: Autentica al usuario y retorna un token JWT
      tags: [ğŸ” Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: âœ… Login exitoso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          description: âŒ Credenciales invÃ¡lidas
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/auth/send-login-code:
    post:
      summary: ğŸ“§ Solicitar cÃ³digo de acceso Ãºnico
      description: EnvÃ­a un cÃ³digo de 6 dÃ­gitos al correo para login sin contraseÃ±a
      tags: [ğŸ” Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmailRequest'
      responses:
        '200':
          description: âœ… CÃ³digo enviado exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          description: âŒ Email no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/auth/login-with-code:
    post:
      summary: ğŸ”‘ Iniciar sesiÃ³n con cÃ³digo
      description: Autentica al usuario usando el cÃ³digo enviado por correo
      tags: [ğŸ” Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginWithCodeRequest'
      responses:
        '200':
          description: âœ… SesiÃ³n iniciada exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '400':
          description: âŒ CÃ³digo invÃ¡lido o expirado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/auth/forgot-password:
    post:
      summary: ğŸ”„ Solicitar recuperaciÃ³n de contraseÃ±a
      description: EnvÃ­a un enlace de recuperaciÃ³n al correo del usuario
      tags: [ğŸ” Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmailRequest'
      responses:
        '200':
          description: âœ… Enlace de recuperaciÃ³n enviado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ForgotPasswordResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/auth/reset-password/{token}:
    post:
      summary: ğŸ” Restablecer contraseÃ±a
      description: Cambia la contraseÃ±a usando el token de recuperaciÃ³n
      tags: [ğŸ” Authentication]
      parameters:
        - name: token
          in: path
          required: true
          schema:
            type: string
          description: Token de recuperaciÃ³n enviado por correo
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ResetPasswordRequest'
      responses:
        '200':
          description: âœ… ContraseÃ±a actualizada con Ã©xito
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
        '400':
          description: âŒ Token invÃ¡lido o contraseÃ±as no coinciden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/auth/profile:
    get:
      summary: ğŸ‘¤ Obtener perfil del usuario autenticado
      description: Retorna los datos del usuario logueado
      tags: [ğŸ‘¤ Profile]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: âœ… Perfil obtenido con Ã©xito
          content:
            application/json:
              schema:
                type: object
                properties:
                  profile:
                    $ref: '#/components/schemas/UserResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/auth/change-password:
    put:
      summary: ğŸ”’ Cambiar contraseÃ±a
      description: Permite al usuario cambiar su contraseÃ±a actual
      tags: [ğŸ” Authentication]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordRequest'
      responses:
        '200':
          description: âœ… ContraseÃ±a actualizada correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/auth/check-email:
    post:
      summary: âœ‰ï¸ Verificar disponibilidad de email
      description: Verifica si un correo electrÃ³nico ya estÃ¡ registrado
      tags: [ğŸ” Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EmailRequest'
      responses:
        '200':
          description: âœ… VerificaciÃ³n completada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CheckEmailResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '415':
          description: âŒ Tipo de contenido no soportado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/auth/check-dni:
    post:
      summary: ğŸ†” Verificar disponibilidad de DNI
      description: Verifica si un nÃºmero de documento ya estÃ¡ registrado
      tags: [ğŸ” Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CheckDniRequest'
      responses:
        '200':
          description: âœ… DNI ya registrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CheckDniResponse'
        '404':
          description: ğŸ†“ DNI disponible
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CheckDniResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/ServerError'

  # =============================================================================
  # ğŸ“ STUDENT ENDPOINTS
  # =============================================================================

  /api/students/profile:
    get:
      summary: ğŸ‘¨â€ğŸ“ Obtener perfil completo del estudiante
      description: Retorna el perfil del estudiante con informaciÃ³n de salud si estÃ¡ disponible
      tags: [ğŸ‘¤ Profile]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: âœ… Perfil del estudiante obtenido con Ã©xito
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StudentProfileResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/students/update-name:
    put:
      summary: âœï¸ Actualizar nombres del estudiante
      tags: [ğŸ‘¤ Profile]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateNameRequest'
      responses:
        '200':
          description: âœ… Nombres actualizados correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/students/update-email:
    put:
      summary: ğŸ“§ Solicitar cambio de email
      description: EnvÃ­a un correo de verificaciÃ³n para cambiar el email
      tags: [ğŸ‘¤ Profile]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateEmailRequest'
      responses:
        '200':
          description: âœ… Correo de verificaciÃ³n enviado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
        '400':
          $ref: '#/components/responses/BadRequest'
        '409':
          description: âš ï¸ Email ya estÃ¡ en uso
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/students/confirm-email-change:
    get:
      summary: âœ… Confirmar cambio de email
      description: Confirma el cambio de email usando el token enviado por correo
      tags: [ğŸ‘¤ Profile]
      parameters:
        - name: token
          in: query
          required: true
          schema:
            type: string
          description: Token de confirmaciÃ³n enviado por correo
      responses:
        '200':
          description: âœ… Email actualizado correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
        '400':
          description: âŒ Token invÃ¡lido o expirado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/students/update-photo:
    put:
      summary: ğŸ“¸ Actualizar foto de perfil
      tags: [ğŸ‘¤ Profile]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
                  description: Imagen del perfil (JPG, PNG, mÃ¡ximo 5MB)
      responses:
        '200':
          description: âœ… Foto actualizada correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdatePhotoResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '413':
          description: ğŸ“¦ Archivo muy grande
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/students/update-about:
    put:
      summary: âœï¸ Actualizar descripciÃ³n personal
      tags: [ğŸ‘¤ Profile]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateAboutRequest'
      responses:
        '200':
          description: âœ… DescripciÃ³n actualizada correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateAboutResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/students/update-socials:
    put:
      summary: ğŸŒ Actualizar redes sociales
      tags: [ğŸ‘¤ Profile]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSocialsRequest'
      responses:
        '200':
          description: âœ… Redes sociales actualizadas correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateSocialsResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/ServerError'

  # Clinical Profile Endpoints
  /api/students/register-clinic:
    post:
      summary: ğŸ¥ Registrar perfil clÃ­nico
      description: Registra los datos clÃ­nicos del estudiante y genera diagnÃ³stico inicial
      tags: [ğŸ¥ Clinical Profile]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClinicalProfileInput'
      responses:
        '201':
          description: âœ… Perfil clÃ­nico registrado y diagnÃ³stico generado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClinicalProfileResponse'
        '400':
          description: âš ï¸ Perfil clÃ­nico ya existe
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/students/clinic-profile:
    get:
      summary: ğŸ“‹ Obtener perfil clÃ­nico
      tags: [ğŸ¥ Clinical Profile]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: âœ… Perfil clÃ­nico encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClinicalProfile'
        '404':
          description: âŒ Perfil clÃ­nico no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/ServerError'
    
    put:
      summary: ğŸ”„ Actualizar perfil clÃ­nico
      tags: [ğŸ¥ Clinical Profile]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClinicalProfileInput'
      responses:
        '200':
          description: âœ… Perfil clÃ­nico actualizado correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClinicalProfileResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    
    delete:
      summary: ğŸ—‘ï¸ Eliminar perfil clÃ­nico
      tags: [ğŸ¥ Clinical Profile]
      security:
        - bearerAuth: []
      responses:
        '204':
          description: âœ… Perfil clÃ­nico eliminado correctamente
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/students/blood-analysis:
    get:
      summary: ğŸ©¸ Obtener datos de anÃ¡lisis de sangre
      description: |
        Retorna Ãºnicamente los valores de laboratorio clÃ­nico sin predicciones de ML.
        Ãštil para prellenar formularios y mostrar datos actuales.
      tags: [ğŸ©¸ Blood Analysis]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: âœ… Datos de anÃ¡lisis obtenidos correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BloodAnalysisResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: âŒ Perfil clÃ­nico no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/students/health-status:
    get:
      summary: â¤ï¸ Obtener estado de salud
      description: Retorna la condiciÃ³n de salud actual y probabilidad del diagnÃ³stico
      tags: [ğŸ¥ Clinical Profile]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: âœ… Estado de salud obtenido con Ã©xito
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthStatusResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: âŒ No se han encontrado datos clÃ­nicos
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  # Recommendations Endpoints
  /api/students/analyze-recommendation:
    post:
      summary: ğŸ§  Generar recomendaciones personalizadas
      description: Analiza los hÃ¡bitos del usuario y genera recomendaciones nutricionales basadas en su perfil clÃ­nico
      tags: [ğŸ’¡ Recommendations]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HabitsAnalysisRequest'
      responses:
        '201':
          description: âœ… Recomendaciones generadas exitosamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RecommendationResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: âŒ Perfil clÃ­nico no encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/students/recommendations:
    get:
      summary: ğŸ’¡ Obtener Ãºltima recomendaciÃ³n
      description: Retorna la Ãºltima recomendaciÃ³n nutricional generada para el usuario
      tags: [ğŸ’¡ Recommendations]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: âœ… Ãšltima recomendaciÃ³n encontrada
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LastRecommendationResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: âŒ No se encontraron recomendaciones
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/students/analysis-history:
    get:
      summary: ğŸ“Š Obtener historial de anÃ¡lisis
      description: Retorna el historial completo de anÃ¡lisis y recomendaciones del estudiante
      tags: [ğŸ“Š Analysis History]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: âœ… Historial recuperado correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalysisHistoryResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/students/analysis/{id}:
    get:
      summary: ğŸ” Obtener anÃ¡lisis especÃ­fico
      description: Retorna un anÃ¡lisis especÃ­fico por su ID
      tags: [ğŸ“Š Analysis History]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID del anÃ¡lisis
      responses:
        '200':
          description: âœ… AnÃ¡lisis recuperado correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AnalysisLog'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  # =============================================================================
  # ğŸ‘¨â€ğŸ’¼ ADMIN ENDPOINTS
  # =============================================================================

  /api/admin/users:
    get:
      summary: ğŸ‘¥ Listar usuarios con paginaciÃ³n
      description: Obtiene una lista paginada de usuarios (excepto el admin actual)
      tags: [ğŸ‘¨â€ğŸ’¼ Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
          description: NÃºmero de pÃ¡gina
        - name: limit
          in: query
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 100
          description: Elementos por pÃ¡gina
        - name: orderBy
          in: query
          schema:
            type: string
            enum: [first_name, last_name, email, createdAt]
            default: createdAt
          description: Campo para ordenar
        - name: orderDir
          in: query
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: DirecciÃ³n del ordenamiento
      responses:
        '200':
          description: âœ… Lista de usuarios obtenida con Ã©xito
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UsersListResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/admin/users/{id}:
    get:
      summary: ğŸ” Obtener usuario por ID
      tags: [ğŸ‘¨â€ğŸ’¼ Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID del usuario
      responses:
        '200':
          description: âœ… Usuario encontrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/admin/users/{id}/role:
    put:
      summary: ğŸ”„ Cambiar rol de usuario
      description: Actualiza el rol de un usuario especÃ­fico
      tags: [ğŸ‘¨â€ğŸ’¼ Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID del usuario
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRoleRequest'
      responses:
        '200':
          description: âœ… Rol actualizado con Ã©xito
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/admin/users/{id}/restore:
    put:
      summary: â™»ï¸ Restaurar usuario eliminado
      description: Restaura un usuario previamente eliminado (soft delete)
      tags: [ğŸ‘¨â€ğŸ’¼ Admin]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
          description: ID del usuario a restaurar
      responses:
        '200':
          description: âœ… Usuario restaurado correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessMessage'
        '400':
          description: âš ï¸ El usuario no estÃ¡ eliminado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/admin/students:
    post:
      summary: â• Crear estudiante con contraseÃ±a temporal
      description: |
        Crea un nuevo estudiante con una contraseÃ±a temporal generada automÃ¡ticamente.
        El estudiante debe cambiar la contraseÃ±a en su primer login.
      tags: [ğŸ‘¨â€ğŸ’¼ Admin]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateStudentRequest'
      responses:
        '201':
          description: âœ… Estudiante creado correctamente
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateStudentResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          description: âš ï¸ Email o DNI ya registrado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          $ref: '#/components/responses/ServerError'

  # =============================================================================
  # ğŸ“‹ AUDIT ENDPOINTS
  # =============================================================================

  /api/admin/audit-logs:
    get:
      summary: ğŸ“ Obtener logs de auditorÃ­a
      description: Retorna el historial de acciones realizadas por el administrador autenticado
      tags: [ğŸ“‹ Audit]
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          schema:
            type: integer
            default: 1
            minimum: 1
        - name: limit
          in: query
          schema:
            type: integer
            default: 20
            minimum: 1
            maximum: 100
      responses:
        '200':
          description: âœ… Logs de auditorÃ­a obtenidos con Ã©xito
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuditLogsResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/ServerError'

# =============================================================================
# ğŸ”§ COMPONENTS
# =============================================================================

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: ğŸ”‘ Token JWT obtenido del endpoint de login

  responses:
    Unauthorized:
      description: âŒ Token invÃ¡lido, expirado o no proporcionado
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "Token invÃ¡lido o expirado"

    Forbidden:
      description: ğŸš« Acceso denegado - Permisos insuficientes
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "No tienes permisos para acceder a este recurso"

    NotFound:
      description: âŒ Recurso no encontrado
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "Recurso no encontrado"

    BadRequest:
      description: âš ï¸ Datos invÃ¡lidos o campos requeridos faltantes
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "Faltan campos obligatorios"

    ServerError:
      description: ğŸ’¥ Error interno del servidor
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            error: "Error interno del servidor"

  schemas:
    # =============================================================================
    # ğŸ”§ COMMON SCHEMAS
    # =============================================================================
    
    ErrorResponse:
      type: object
      properties:
        error:
          type: string
          description: ğŸ“ Mensaje de error descriptivo
      required: [error]
      example:
        error: "Mensaje de error descriptivo"

    SuccessMessage:
      type: object
      properties:
        message:
          type: string
          description: âœ… Mensaje de Ã©xito
      required: [message]
      example:
        message: "OperaciÃ³n completada con Ã©xito"

    TokenResponse:
      type: object
      properties:
        token:
          type: string
          description: ğŸ”‘ Token JWT de autenticaciÃ³n
      required: [token]
      example:
        token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

    # =============================================================================
    # ğŸ‘¤ USER SCHEMAS
    # =============================================================================

    UserResponse:
      type: object
      properties:
        id:
          type: integer
          description: ğŸ†” ID Ãºnico del usuario
        first_name:
          type: string
          description: ğŸ‘¤ Primer nombre
        last_name:
          type: string
          description: ğŸ‘¤ Apellido paterno
        middle_name:
          type: string
          description: ğŸ‘¤ Apellido materno
        document_number:
          type: string
          description: ğŸ†” NÃºmero de documento de identidad
        email:
          type: string
          format: email
          description: ğŸ“§ Correo electrÃ³nico
        role:
          type: string
          enum: [student, admin]
          description: ğŸ‘¥ Rol del usuario
        profile_image:
          type: string
          nullable: true
          description: ğŸ“¸ URL de la imagen de perfil
        about_me:
          type: string
          nullable: true
          description: âœï¸ DescripciÃ³n personal
        social_links:
          type: object
          nullable: true
          additionalProperties:
            type: string
          description: ğŸŒ Enlaces a redes sociales
        createdAt:
          type: string
          format: date-time
          description: ğŸ“… Fecha de creaciÃ³n
      example:
        id: 1
        first_name: "Juan"
        last_name: "PÃ©rez"
        middle_name: "GarcÃ­a"
        document_number: "12345678"
        email: "juan.perez@example.com"
        role: "student"
        profile_image: "http://localhost:5000/uploads/profile-images/user-1.jpg"
        about_me: "Estudiante de nutriciÃ³n interesado en vida saludable"
        social_links:
          facebook: "https://facebook.com/juan.perez"
          instagram: "https://instagram.com/juan.perez"
        createdAt: "2024-01-15T10:30:00Z"

    # =============================================================================
    # ğŸ” AUTHENTICATION SCHEMAS
    # =============================================================================

    RegisterRequest:
      type: object
      required: [first_name, last_name, middle_name, document_number, email, password, confirm_password]
      properties:
        first_name:
          type: string
          minLength: 2
          maxLength: 50
          pattern: '^[a-zA-ZÃ¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“ÃšÃ±Ã‘\s]+$'
          description: ğŸ‘¤ Primer nombre
        last_name:
          type: string
          minLength: 2
          maxLength: 50
          pattern: '^[a-zA-ZÃ¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“ÃšÃ±Ã‘\s]+$'
          description: ğŸ‘¤ Apellido paterno
        middle_name:
          type: string
          minLength: 2
          maxLength: 50
          pattern: '^[a-zA-ZÃ¡Ã©Ã­Ã³ÃºÃÃ‰ÃÃ“ÃšÃ±Ã‘\s]+$'
          description: ğŸ‘¤ Apellido materno
        document_number:
          type: string
          pattern: '^\d{8}$'
          description: ğŸ†” DNI de 8 dÃ­gitos
        email:
          type: string
          format: email
          description: ğŸ“§ Correo electrÃ³nico vÃ¡lido
        password:
          type: string
          minLength: 6
          description: ğŸ”’ ContraseÃ±a (mÃ­nimo 6 caracteres)
        confirm_password:
          type: string
          description: ğŸ”’ ConfirmaciÃ³n de contraseÃ±a (debe coincidir)
      example:
        first_name: "Luis"
        last_name: "Ramos"
        middle_name: "PÃ©rez"
        document_number: "12345678"
        email: "luis.ramos@example.com"
        password: "micontraseÃ±a123"
        confirm_password: "micontraseÃ±a123"

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
          format: email
          description: ğŸ“§ Correo electrÃ³nico registrado
        password:
          type: string
          description: ğŸ”’ ContraseÃ±a del usuario
      example:
        email: "luis.ramos@example.com"
        password: "micontraseÃ±a123"

    LoginResponse:
      type: object
      properties:
        token:
          type: string
          description: ğŸ”‘ Token JWT de autenticaciÃ³n
        mustChangePassword:
          type: boolean
          description: ğŸ”„ Indica si el usuario debe cambiar su contraseÃ±a
      required: [token, mustChangePassword]
      example:
        token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        mustChangePassword: false

    LoginWithCodeRequest:
      type: object
      required: [email, code]
      properties:
        email:
          type: string
          format: email
          description: ğŸ“§ Correo electrÃ³nico registrado
        code:
          type: string
          pattern: '^\d{6}$'
          description: ğŸ”¢ CÃ³digo de 6 dÃ­gitos enviado por correo
      example:
        email: "usuario@example.com"
        code: "123456"

    EmailRequest:
      type: object
      required: [email]
      properties:
        email:
          type: string
          format: email
          description: ğŸ“§ DirecciÃ³n de correo electrÃ³nico
      example:
        email: "usuario@example.com"

    ForgotPasswordResponse:
      type: object
      properties:
        message:
          type: string
        obfuscatedEmail:
          type: string
          description: ğŸ“§ Email ofuscado para confirmar el envÃ­o
      example:
        message: "Correo enviado con enlace de recuperaciÃ³n"
        obfuscatedEmail: "u****o@example.com"

    ResetPasswordRequest:
      type: object
      required: [new_password, confirm_password]
      properties:
        new_password:
          type: string
          minLength: 6
          description: ğŸ”’ Nueva contraseÃ±a
        confirm_password:
          type: string
          description: ğŸ”’ ConfirmaciÃ³n de la nueva contraseÃ±a
      example:
        new_password: "nuevacontraseÃ±a123"
        confirm_password: "nuevacontraseÃ±a123"

    ChangePasswordRequest:
      type: object
      required: [current_password, new_password, confirm_password]
      properties:
        current_password:
          type: string
          description: ğŸ”’ ContraseÃ±a actual
        new_password:
          type: string
          minLength: 6
          description: ğŸ”’ Nueva contraseÃ±a
        confirm_password:
          type: string
          description: ğŸ”’ ConfirmaciÃ³n de la nueva contraseÃ±a
      example:
        current_password: "contraseÃ±aactual"
        new_password: "nuevacontraseÃ±a123"
        confirm_password: "nuevacontraseÃ±a123"

    CheckEmailResponse:
      type: object
      properties:
        exists:
          type: boolean
          description: âœ… Indica si el correo ya estÃ¡ registrado
        message:
          type: string
          description: ğŸ“ Mensaje descriptivo del resultado
      required: [exists, message]
      example:
        exists: false
        message: "El correo electrÃ³nico estÃ¡ disponible"

    CheckDniRequest:
      type: object
      required: [document_number]
      properties:
        document_number:
          type: string
          pattern: '^\d{8}$'
          description: ğŸ†” NÃºmero de DNI a verificar
      example:
        document_number: "12345678"

    CheckDniResponse:
      type: object
      properties:
        exists:
          type: boolean
          description: âœ… Indica si el DNI ya estÃ¡ registrado
        message:
          type: string
          description: ğŸ“ Mensaje descriptivo del resultado
      required: [exists, message]
      example:
        exists: false
        message: "El DNI estÃ¡ disponible"

    # =============================================================================
    # ğŸ“ STUDENT SCHEMAS
    # =============================================================================

    StudentProfileResponse:
      type: object
      properties:
        profile:
          $ref: '#/components/schemas/UserResponse'
        health_condition:
          type: string
          nullable: true
          description: ğŸ¥ CondiciÃ³n de salud diagnosticada
        probability:
          type: number
          format: float
          nullable: true
          description: ğŸ“Š Probabilidad del diagnÃ³stico (0-100)
        has_recommendation:
          type: boolean
          description: ğŸ’¡ Indica si el usuario tiene recomendaciones disponibles
      example:
        profile:
          id: 1
          first_name: "Ana"
          last_name: "GarcÃ­a"
          middle_name: "LÃ³pez"
          email: "ana.garcia@example.com"
          role: "student"
        health_condition: "Anemia"
        probability: 85.7
        has_recommendation: true

    UpdateNameRequest:
      type: object
      required: [first_name, middle_name, last_name]
      properties:
        first_name:
          type: string
          minLength: 2
          maxLength: 50
        middle_name:
          type: string
          minLength: 2
          maxLength: 50
        last_name:
          type: string
          minLength: 2
          maxLength: 50
      example:
        first_name: "Luis"
        middle_name: "Alberto"
        last_name: "Rojas"

    UpdateEmailRequest:
      type: object
      required: [new_email]
      properties:
        new_email:
          type: string
          format: email
          description: ğŸ“§ Nuevo correo electrÃ³nico
      example:
        new_email: "nuevo.email@example.com"

    UpdatePhotoResponse:
      type: object
      properties:
        message:
          type: string
        profile_image:
          type: string
          description: ğŸ“¸ URL de la nueva imagen de perfil
      example:
        message: "Foto de perfil actualizada correctamente"
        profile_image: "http://localhost:5000/uploads/profile-images/user-123.jpg"

    UpdateAboutRequest:
      type: object
      properties:
        about_me:
          type: string
          maxLength: 500
          description: âœï¸ DescripciÃ³n personal (mÃ¡ximo 500 caracteres)
      example:
        about_me: "Estudiante de ingenierÃ­a apasionado por la IA y la nutriciÃ³n"

    UpdateAboutResponse:
      type: object
      properties:
        message:
          type: string
        about_me:
          type: string
      example:
        message: "DescripciÃ³n actualizada correctamente"
        about_me: "Estudiante de ingenierÃ­a apasionado por la IA y la nutriciÃ³n"

    UpdateSocialsRequest:
      type: object
      properties:
        facebook:
          type: string
          format: uri
          nullable: true
        instagram:
          type: string
          format: uri
          nullable: true
        twitter:
          type: string
          format: uri
          nullable: true
        linkedin:
          type: string
          format: uri
          nullable: true
      example:
        facebook: "https://facebook.com/usuario"
        instagram: "https://instagram.com/usuario"
        linkedin: "https://linkedin.com/in/usuario"

    UpdateSocialsResponse:
      type: object
      properties:
        message:
          type: string
        social_links:
          type: object
          additionalProperties:
            type: string
      example:
        message: "Redes sociales actualizadas correctamente"
        social_links:
          facebook: "https://facebook.com/usuario"
          instagram: "https://instagram.com/usuario"

    # =============================================================================
    # ğŸ¥ CLINICAL SCHEMAS
    # =============================================================================

    ClinicalProfileInput:
      type: object
      required: [age, gender, bmi, hbA1c, blood_glucose_level, hemoglobin, insulin, triglycerides, hematocrit, red_blood_cells, smoking_history]
      properties:
        age:
          type: integer
          minimum: 16
          maximum: 35
          description: ğŸ“… Edad del paciente en aÃ±os
        gender:
          type: string
          enum: [Male, Female]
          description: ğŸ‘¤ GÃ©nero del paciente
        bmi:
          type: number
          format: float
          minimum: 0
          description: âš–ï¸ Ãndice de Masa Corporal (kg/mÂ²)
        hbA1c:
          type: number
          format: float
          minimum: 0
          description: ğŸ©¸ Hemoglobina glicosilada (%)
        blood_glucose_level:
          type: number
          format: float
          minimum: 0
          description: ğŸ¬ Nivel de glucosa en sangre (mg/dL)
        hemoglobin:
          type: number
          format: float
          minimum: 0
          description: ğŸ©¸ Nivel de hemoglobina (g/dL)
        insulin:
          type: number
          format: float
          minimum: 0
          description: ğŸ’‰ Nivel de insulina (Î¼U/mL)
        triglycerides:
          type: number
          format: float
          minimum: 0
          description: ğŸ§¬ Nivel de triglicÃ©ridos (mg/dL)
        hematocrit:
          type: number
          format: float
          minimum: 0
          description: ğŸ©¸ Porcentaje de hematocrito (%)
        red_blood_cells:
          type: number
          format: float
          minimum: 0
          description: ğŸ”´ Conteo de glÃ³bulos rojos (millones/Î¼L)
        smoking_history:
          type: string
          enum: [Never, Former, Current, Ever, Not Current, No Info]
          description: ğŸš¬ Historial de tabaquismo
      example:
        age: 25
        gender: "Male"
        bmi: 23.5
        hbA1c: 5.8
        blood_glucose_level: 95
        hemoglobin: 14.2
        insulin: 85
        triglycerides: 150
        hematocrit: 42
        red_blood_cells: 4.5
        smoking_history: "Never"

    ClinicalProfile:
      allOf:
        - $ref: '#/components/schemas/ClinicalProfileInput'
        - type: object
          properties:
            id:
              type: integer
              description: ğŸ†” ID del perfil clÃ­nico
            user_id:
              type: integer
              description: ğŸ†” ID del usuario
            condition:
              type: string
              description: ğŸ¥ CondiciÃ³n diagnosticada
            createdAt:
              type: string
              format: date-time
            updatedAt:
              type: string
              format: date-time

    ClinicalProfileResponse:
      type: object
      properties:
        message:
          type: string
          description: âœ… Mensaje de confirmaciÃ³n
        condicionPrincipal:
          type: string
          description: ğŸ¥ CondiciÃ³n de salud principal diagnosticada
        porcentajeDiagnostico:
          type: number
          format: float
          description: ğŸ“Š Porcentaje de probabilidad del diagnÃ³stico principal
        todasLasProbabilidades:
          type: object
          additionalProperties:
            type: number
          description: ğŸ“ˆ Probabilidades de todas las condiciones analizadas
      example:
        message: "Perfil clÃ­nico y diagnÃ³stico registrados correctamente"
        condicionPrincipal: "Diabetes"
        porcentajeDiagnostico: 81.2
        todasLasProbabilidades:
          Healthy: 5.3
          Diabetes: 81.2
          Anemia: 10.5
          Ambos: 3.0

    BloodAnalysisResponse:
      type: object
      properties:
        success:
          type: boolean
          description: âœ… Indica si la operaciÃ³n fue exitosa
        bloodAnalysis:
          $ref: '#/components/schemas/ClinicalProfileInput'
      example:
        success: true
        bloodAnalysis:
          age: 25
          gender: "Male"
          bmi: 23.5
          hbA1c: 5.8
          blood_glucose_level: 95
          hemoglobin: 14.2
          insulin: 85
          triglycerides: 150
          hematocrit: 42
          red_blood_cells: 4.5
          smoking_history: "Never"

    HealthStatusResponse:
      type: object
      properties:
        health_condition:
          type: string
          description: ğŸ¥ CondiciÃ³n de salud actual
        probability:
          type: number
          format: float
          description: ğŸ“Š Probabilidad del diagnÃ³stico (0-100)
      example:
        health_condition: "Diabetes"
        probability: 90.17

    # =============================================================================
    # ğŸ’¡ RECOMMENDATIONS SCHEMAS
    # =============================================================================

    HabitsAnalysisRequest:
      type: object
      required: [habits]
      properties:
        habits:
          type: object
          required: [comidas_dia, frutas_verduras, alergias, bebidas_azucaradas, actividad_fisica, objetivo_alimentacion, ultraprocesados, estres, energia_fatiga, comidas_fuera]
          properties:
            comidas_dia:
              type: string
              description: ğŸ½ï¸ NÃºmero de comidas por dÃ­a
            frutas_verduras:
              type: string
              description: ğŸ¥¬ Porciones de frutas y verduras diarias
            alergias:
              type: string
              description: âš ï¸ Alergias o intolerancias alimentarias
            bebidas_azucaradas:
              type: string
              description: ğŸ¥¤ Frecuencia de consumo de bebidas azucaradas
            actividad_fisica:
              type: string
              description: ğŸƒâ€â™‚ï¸ Nivel de actividad fÃ­sica
            objetivo_alimentacion:
              type: string
              description: ğŸ¯ Objetivo nutricional del usuario
            ultraprocesados:
              type: string
              description: ğŸŸ Frecuencia de consumo de alimentos ultraprocesados
            estres:
              type: string
              description: ğŸ˜° Nivel de estrÃ©s percibido
            energia_fatiga:
              type: string
              description: âš¡ Niveles de energÃ­a y fatiga
            comidas_fuera:
              type: string
              description: ğŸ½ï¸ Frecuencia de comidas fuera de casa
          example:
            comidas_dia: "3"
            frutas_verduras: "2-3"
            alergias: "Intolerancia a la lactosa"
            bebidas_azucaradas: "1-2 veces por semana"
            actividad_fisica: "Moderado"
            objetivo_alimentacion: "Mantener peso"
            ultraprocesados: "3+ veces"
            estres: "Alto"
            energia_fatiga: "A veces"
            comidas_fuera: "3-5 veces por semana"

    RecommendationResponse:
      type: object
      properties:
        message:
          type: string
          description: âœ… Mensaje de confirmaciÃ³n
        condition:
          type: string
          description: ğŸ¥ CondiciÃ³n de salud del usuario
        recommendations:
          type: array
          items:
            type: string
          description: ğŸ’¡ Lista de recomendaciones nutricionales
      example:
        message: "Recomendaciones generadas y guardadas correctamente ğŸ§ ğŸ½ï¸"
        condition: "Anemia"
        recommendations: ["Hierro", "Vitamina C", "Fibra"]

    LastRecommendationResponse:
      type: object
      properties:
        condition:
          type: string
          description: ğŸ¥ CondiciÃ³n de salud
        recommendations:
          type: array
          items:
            type: string
          description: ğŸ’¡ Lista de recomendaciones
      example:
        condition: "Diabetes"
        recommendations: ["Verduras sin almidÃ³n", "Vitamina C"]

    AnalysisLog:
      type: object
      properties:
        id:
          type: integer
          description: ğŸ†” ID del anÃ¡lisis
        condition:
          type: string
          description: ğŸ¥ CondiciÃ³n diagnosticada
        recommendations:
          type: array
          items:
            type: string
          description: ğŸ’¡ Recomendaciones generadas
        createdAt:
          type: string
          format: date-time
          description: ğŸ“… Fecha de creaciÃ³n del anÃ¡lisis
      example:
        id: 1
        condition: "Diabetes"
        recommendations: ["Verduras sin almidÃ³n", "ProteÃ­nas magras"]
        createdAt: "2024-01-15T10:30:00Z"

    AnalysisHistoryResponse:
      type: object
      properties:
        history:
          type: array
          items:
            $ref: '#/components/schemas/AnalysisLog'
          description: ğŸ“Š Lista de anÃ¡lisis histÃ³ricos
      example:
        history:
          - id: 1
            condition: "Diabetes"
            recommendations: ["Verduras sin almidÃ³n", "ProteÃ­nas magras"]
            createdAt: "2024-01-15T10:30:00Z"
          - id: 2
            condition: "Anemia"
            recommendations: ["Hierro", "Vitamina C"]
            createdAt: "2024-01-10T08:15:00Z"

    # =============================================================================
    # ğŸ‘¨â€ğŸ’¼ ADMIN SCHEMAS
    # =============================================================================

    UsersListResponse:
      type: object
      properties:
        users:
          type: array
          items:
            $ref: '#/components/schemas/UserResponse'
        page:
          type: integer
          description: ğŸ“„ PÃ¡gina actual
        limit:
          type: integer
          description: ğŸ“Š Elementos por pÃ¡gina
        total:
          type: integer
          description: ğŸ”¢ Total de usuarios
        pages:
          type: integer
          description: ğŸ“„ Total de pÃ¡ginas
      example:
        users: []
        page: 1
        limit: 10
        total: 25
        pages: 3

    UpdateRoleRequest:
      type: object
      required: [role]
      properties:
        role:
          type: string
          enum: [student, admin]
          description: ğŸ‘¥ Nuevo rol para el usuario
      example:
        role: "admin"

    CreateStudentRequest:
      type: object
      required: [first_name, last_name, middle_name, document_number, email]
      properties:
        first_name:
          type: string
          minLength: 2
          maxLength: 50
          description: ğŸ‘¤ Primer nombre del estudiante
        last_name:
          type: string
          minLength: 2
          maxLength: 50
          description: ğŸ‘¤ Apellido paterno
        middle_name:
          type: string
          minLength: 2
          maxLength: 50
          description: ğŸ‘¤ Apellido materno
        document_number:
          type: string
          pattern: '^\d{8}$'
          description: ğŸ†” DNI de 8 dÃ­gitos
        email:
          type: string
          format: email
          description: ğŸ“§ Correo electrÃ³nico del estudiante
      example:
        first_name: "Carlos"
        last_name: "Torres"
        middle_name: "MejÃ­a"
        document_number: "87654321"
        email: "carlos.torres@example.com"

    CreateStudentResponse:
      type: object
      properties:
        message:
          type: string
          description: âœ… Mensaje de confirmaciÃ³n
        temporalPassword:
          type: string
          description: ğŸ”‘ ContraseÃ±a temporal generada
        user:
          type: object
          properties:
            id:
              type: integer
            name:
              type: string
            email:
              type: string
      example:
        message: "Estudiante registrado correctamente"
        temporalPassword: "a1b2c3d4"
        user:
          id: 5
          name: "Carlos Torres MejÃ­a"
          email: "carlos.torres@example.com"

    # =============================================================================
    # ğŸ“‹ AUDIT SCHEMAS
    # =============================================================================

    AuditLog:
      type: object
      properties:
        id:
          type: integer
          description: ğŸ†” ID del log de auditorÃ­a
        action:
          type: string
          enum: [delete, restore, role_change, create]
          description: ğŸ¬ AcciÃ³n realizada
        user_id:
          type: integer
          description: ğŸ‘¨â€ğŸ’¼ ID del administrador que ejecutÃ³ la acciÃ³n
        target_id:
          type: integer
          description: ğŸ¯ ID del usuario afectado
        timestamp:
          type: string
          format: date-time
          description: ğŸ“… Fecha y hora de la acciÃ³n
        performed_by:
          type: object
          properties:
            id:
              type: integer
            first_name:
              type: string
            last_name:
              type: string
            middle_name:
              type: string
            document_number:
              type: string
            email:
              type: string
          description: ğŸ‘¨â€ğŸ’¼ InformaciÃ³n del administrador que realizÃ³ la acciÃ³n
      example:
        id: 1
        action: "delete"
        user_id: 1
        target_id: 5
        timestamp: "2024-01-15T14:30:00Z"
        performed_by:
          id: 1
          first_name: "Admin"
          last_name: "Principal"
          middle_name: "Sistema"
          document_number: "00000000"
          email: "admin@nutriscanu.com"

    AuditLogsResponse:
      type: object
      properties:
        logs:
          type: array
          items:
            $ref: '#/components/schemas/AuditLog'
        page:
          type: integer
          description: ğŸ“„ PÃ¡gina actual
        limit:
          type: integer
          description: ğŸ“Š Elementos por pÃ¡gina
        total:
          type: integer
          description: ğŸ”¢ Total de logs
        pages:
          type: integer
          description: ğŸ“„ Total de pÃ¡ginas
      example:
        logs: []
        page: 1
        limit: 20
        total: 50
        pages: 3
